<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîî BI –ê–ª–∞—Ä–º–∞ –∑–∞ –ê–Ω–æ–º–∞–ª–∏–∏ - Professional Edition</title>
    
    <!-- Favicons -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üîî</text></svg>">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        /* Login Screen Styles */
        #loginScreen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            padding: 40px;
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .login-title {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
            font-weight: 600;
        }

        .login-subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e1e1;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .auth-link {
            color: #667eea;
            text-decoration: none;
            margin-top: 15px;
            display: inline-block;
        }

        .auth-link:hover {
            text-decoration: underline;
        }

        #authError {
            background: #ff6b6b;
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            display: none;
        }

        /* Main App Styles */
        #mainApp {
            display: none;
            min-height: 100vh;
            background: #f5f7fa;
        }

        .header {
            background: white;
            padding: 15px 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #333;
            font-size: 24px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-details {
            text-align: right;
        }

        #userEmail {
            font-weight: 600;
            color: #333;
        }

        #userRole {
            font-size: 12px;
            color: #666;
            background: #e3f2fd;
            padding: 2px 8px;
            border-radius: 12px;
            margin-top: 2px;
            display: inline-block;
        }

        .nav-container {
            background: white;
            border-bottom: 1px solid #e1e1e1;
        }

        .nav-tabs {
            display: flex;
            list-style: none;
            padding: 0 30px;
        }

        .nav-item {
            margin-right: 30px;
        }

        .nav-link {
            display: block;
            padding: 15px 0;
            color: #666;
            text-decoration: none;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .nav-item.active .nav-link,
        .nav-link:hover {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .container {
            padding: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        /* Dashboard Styles */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .metric {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
        }

        /* Admin Panel Styles */
        .admin-header {
            background: #ff6b6b;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .admin-header h2 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .table-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e1e1e1;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        .btn-sm {
            padding: 5px 10px;
            font-size: 12px;
            margin-right: 5px;
        }

        .btn-danger {
            background: #ff6b6b;
        }

        /* Data Input Tabs */
        .data-input-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #e1e1e1;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab-btn.active,
        .tab-btn:hover {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .data-tab-content {
            display: none;
            padding: 20px 0;
        }

        .data-tab-content.active {
            display: block;
        }

        .form-group label {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
            display: block;
        }

        /* Alert Styles */
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid;
        }

        .alert-critical {
            background: #ffe6e6;
            border-left-color: #ff6b6b;
            color: #c92a2a;
        }

        .alert-warning {
            background: #fff4e6;
            border-left-color: #ffa94d;
            color: #d9480f;
        }

        .alert-info {
            background: #e3f2fd;
            border-left-color: #2196f3;
            color: #1565c0;
        }

        .alert-success {
            background: #e8f5e8;
            border-left-color: #4caf50;
            color: #2e7d32;
        }

        .alert-time {
            font-size: 12px;
            color: #666;
            float: right;
        }

        /* Chart Container */
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 10px;
            }

            .nav-tabs {
                flex-wrap: wrap;
                padding: 0 15px;
            }

            .nav-item {
                margin-right: 15px;
            }

            .container {
                padding: 15px;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Loading indicator */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen">
        <div class="login-container">
            <h1 class="login-title">üîî BI –ê–ª–∞—Ä–º–∞ –∑–∞ –ê–Ω–æ–º–∞–ª–∏–∏</h1>
            <p class="login-subtitle">Professional Edition ‚Ä¢ Secure Access</p>
            
            <div id="authError"></div>
            
            <!-- Login Form -->
            <form id="loginForm">
                <div class="form-group">
                    <input type="email" id="loginEmail" class="form-control" placeholder="–í—ä–≤–µ–¥–µ—Ç–µ –∏–º–µ–π–ª –∞–¥—Ä–µ—Å" required>
                </div>
                <div class="form-group">
                    <input type="password" id="loginPassword" class="form-control" placeholder="–í—ä–≤–µ–¥–µ—Ç–µ –ø–∞—Ä–æ–ª–∞" required>
                </div>
                <button type="button" onclick="login()" class="btn">–í—Ö–æ–¥</button>
                <a href="#" id="showRegister" class="auth-link">–∏–ª–∏ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
            </form>
            
            <!-- Register Form -->
            <form id="registerForm" style="display: none;">
                <div class="form-group">
                    <input type="text" id="registerName" class="form-control" placeholder="–ü—ä–ª–Ω–æ –∏–º–µ" required>
                </div>
                <div class="form-group">
                    <input type="email" id="registerEmail" class="form-control" placeholder="–ò–º–µ–π–ª –∞–¥—Ä–µ—Å" required>
                </div>
                <div class="form-group">
                    <input type="password" id="registerPassword" class="form-control" placeholder="–ü–∞—Ä–æ–ª–∞ (–º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–∞)" required>
                </div>
                <div class="form-group">
                    <input type="password" id="registerConfirmPassword" class="form-control" placeholder="–ü–æ—Ç–≤—ä—Ä–¥–∏ –ø–∞—Ä–æ–ª–∞" required>
                </div>
                <button type="button" onclick="register()" class="btn">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                <a href="#" id="showLogin" class="auth-link">–ò–º–∞–º –∞–∫–∞—É–Ω—Ç? –í—Ö–æ–¥</a>
            </form>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp">
        <!-- Header -->
        <header class="header">
            <h1>üîî BI –ê–ª–∞—Ä–º–∞ –∑–∞ –ê–Ω–æ–º–∞–ª–∏–∏</h1>
            <div class="user-info">
                <div class="user-details">
                    <div id="userEmail"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="9de8eef8efddf8e5fcf0edf1f8b3fef2f0">[email&#160;protected]</a></div>
                    <div id="userRole">–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª</div>
                </div>
                <button onclick="logout()" class="btn" style="width: auto;">–ò–∑—Ö–æ–¥</button>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav-container">
            <ul class="nav-tabs">
                <li class="nav-item active">
                    <a href="#" onclick="showScreen('dashboard')" class="nav-link">üìä Dashboard</a>
                </li>
                <li class="nav-item">
                    <a href="#" onclick="showScreen('alerts')" class="nav-link">üö® –ê–ª–∞—Ä–º–∏</a>
                </li>
                <li class="nav-item">
                    <a href="#" onclick="showScreen('analysis')" class="nav-link">üìà –ê–Ω–∞–ª–∏–∑</a>
                </li>
                <li class="nav-item">
                    <a href="#" onclick="showScreen('settings')" class="nav-link">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
                </li>
                <li class="nav-item" id="adminNavBtn" style="display: none;">
                    <a href="#" onclick="showAdminPanel()" class="nav-link">üëë –ê–¥–º–∏–Ω</a>
                </li>
            </ul>
        </nav>

        <!-- Main Content Container -->
        <div class="container">
            <!-- Dashboard Screen -->
            <div id="dashboard" class="screen active">
                <h2>üìä Dashboard</h2>
                
                <!-- Main Metrics -->
                <div class="dashboard-grid">
                    <div class="card">
                        <h3>üö® –ê–∫—Ç–∏–≤–Ω–∏ –ê–ª–∞—Ä–º–∏</h3>
                        <div class="metric" style="color: #ff6b6b;" id="dashboardActiveAlerts">0</div>
                        <p id="dashboardAlertsDetails">–ù—è–º–∞ –∞–∫—Ç–∏–≤–Ω–∏ –∞–ª–∞—Ä–º–∏</p>
                        <small style="color: #666;" id="dashboardLastAlert">-</small>
                    </div>
                    <div class="card">
                        <h3>üìä –ê–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω–∏ –î–∞–Ω–Ω–∏</h3>
                        <div class="metric" id="dashboardDataCount">0</div>
                        <p>–ó–∞–ø–∏—Å–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω–∏ –æ–±—â–æ</p>
                        <small style="color: #4caf50;" id="dashboardDataTrend">–î–æ–±–∞–≤–µ—Ç–µ –¥–∞–Ω–Ω–∏ –∑–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</small>
                    </div>
                    <div class="card">
                        <h3>üéØ –°–∏—Å—Ç–µ–º–µ–Ω –°—Ç–∞—Ç—É—Å</h3>
                        <div class="metric" style="color: #4CAF50;">‚úì</div>
                        <p>–í—Å–∏—á–∫–æ —Ä–∞–±–æ—Ç–∏ –Ω–æ—Ä–º–∞–ª–Ω–æ</p>
                        <small style="color: #666;">–ì–æ—Ç–æ–≤ –∑–∞ –∞–Ω–∞–ª–∏–∑</small>
                    </div>
                    <div class="card">
                        <h3>‚ö° –ü–æ—Å–ª–µ–¥–Ω–æ –°–∫–∞–Ω–∏—Ä–∞–Ω–µ</h3>
                        <div class="metric" id="dashboardLastScan" style="font-size: 18px;">–ù–∏–∫–æ–≥–∞</div>
                        <p>–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å–∫–∞–Ω–∏—Ä–∞–Ω–µ</p>
                        <small style="color: #2196f3;" id="dashboardScanStatus">–°—Ç–∞—Ä—Ç–∏—Ä–∞ –ø—Ä–∏ –Ω–æ–≤–∏ –¥–∞–Ω–Ω–∏</small>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card">
                    <h3>‚ö° –ë—ä—Ä–∑–∏ –î–µ–π—Å—Ç–≤–∏—è</h3>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="runImmediateScan()" class="btn" style="width: auto;">üîç –ù–µ–∑–∞–±–∞–≤–Ω–æ —Å–∫–∞–Ω–∏—Ä–∞–Ω–µ</button>
                        <button onclick="showScreen('alerts')" class="btn" style="width: auto;">üö® –í–∏–∂ –≤—Å–∏—á–∫–∏ –∞–ª–∞—Ä–º–∏</button>
                        <button onclick="showScreen('settings')" class="btn" style="width: auto;">‚öôÔ∏è –î–æ–±–∞–≤–∏ –¥–∞–Ω–Ω–∏</button>
                        <button onclick="exportDashboardReport()" class="btn" style="width: auto;">üì§ –ï–∫—Å–ø–æ—Ä—Ç–∏—Ä–∞–π –æ—Ç—á–µ—Ç</button>
                    </div>
                </div>
            </div>

            <!-- Alerts Screen -->
            <div id="alerts" class="screen">
                <h2>üö® –ê–ª–∞—Ä–º–∏ –∑–∞ –ê–Ω–æ–º–∞–ª–∏–∏</h2>
                
                <!-- Alert Summary -->
                <div class="dashboard-grid" style="margin-bottom: 30px;">
                    <div class="card">
                        <h3>üî¥ –ö—Ä–∏—Ç–∏—á–Ω–∏</h3>
                        <div class="metric" style="color: #ff6b6b;" id="criticalAlertsCount">0</div>
                        <p>–ò–∑–∏—Å–∫–≤–∞—Ç –Ω–µ–∑–∞–±–∞–≤–Ω–∏ –¥–µ–π—Å—Ç–≤–∏—è</p>
                    </div>
                    <div class="card">
                        <h3>üü° –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è</h3>
                        <div class="metric" style="color: #ffa94d;" id="warningAlertsCount">0</div>
                        <p>–ò–∑–∏—Å–∫–≤–∞—Ç –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ</p>
                    </div>
                    <div class="card">
                        <h3>üü¢ –†–µ—à–µ–Ω–∏</h3>
                        <div class="metric" style="color: #4caf50;" id="resolvedAlertsCount">0</div>
                        <p>–û–±—â–æ —Ä–µ—à–µ–Ω–∏</p>
                    </div>
                </div>

                <!-- Live Alerts -->
                <div class="card">
                    <h3>üîî –ê–∫—Ç–∏–≤–Ω–∏ –ê–ª–∞—Ä–º–∏</h3>
                    <div id="activeAlerts">
                        <div class="alert alert-success">
                            üéâ <strong>–î–æ–±—Ä–µ –¥–æ—à–ª–∏ –≤ BI —Å–∏—Å—Ç–µ–º–∞—Ç–∞!</strong><br>
                            –ù—è–º–∞ –∞–∫—Ç–∏–≤–Ω–∏ –∞–ª–∞—Ä–º–∏. –î–æ–±–∞–≤–µ—Ç–µ –¥–∞–Ω–Ω–∏ –≤ —Ä–∞–∑–¥–µ–ª "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" –∑–∞ –¥–∞ –∑–∞–ø–æ—á–Ω–µ—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.
                        </div>
                    </div>
                </div>

                <!-- Alert History -->
                <div class="card">
                    <h3>üìú –ò—Å—Ç–æ—Ä–∏—è –Ω–∞ –ê–ª–∞—Ä–º–∏</h3>
                    <div id="alertHistory">
                        <table style="width: 100%; margin-top: 15px;">
                            <thead>
                                <tr>
                                    <th>–í—Ä–µ–º–µ</th>
                                    <th>–¢–∏–ø</th>
                                    <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                                    <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="5" style="text-align: center; color: #666;">–ù—è–º–∞ –∏—Å—Ç–æ—Ä–∏—è –Ω–∞ –∞–ª–∞—Ä–º–∏</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Alert Controls -->
                <div class="card">
                    <h3>üéõÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –ê–ª–∞—Ä–º–∏</h3>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="markAllAlertsRead()" class="btn" style="width: auto;">‚úÖ –ú–∞—Ä–∫–∏—Ä–∞–π –≤—Å–∏—á–∫–∏ –∫–∞—Ç–æ –ø—Ä–æ—á–µ—Ç–µ–Ω–∏</button>
                        <button onclick="exportAlerts()" class="btn" style="width: auto;">üì§ –ï–∫—Å–ø–æ—Ä—Ç–∏—Ä–∞–π –∞–ª–∞—Ä–º–∏</button>
                        <button onclick="clearOldAlerts()" class="btn" style="width: auto;">üóëÔ∏è –ò–∑—á–∏—Å—Ç–∏ —Å—Ç–∞—Ä–∏ –∞–ª–∞—Ä–º–∏</button>
                        <button onclick="runAnomalyCheck()" class="btn" style="width: auto;">üîç –ü—Ä–æ–≤–µ—Ä–∏ –∑–∞ –∞–Ω–æ–º–∞–ª–∏–∏ —Å–µ–≥–∞</button>
                    </div>
                </div>
            </div>

            <!-- Analysis Screen -->
            <div id="analysis" class="screen">
                <h2>üìà –ê–Ω–∞–ª–∏–∑ –Ω–∞ –î–∞–Ω–Ω–∏</h2>
                
                <!-- Analysis Summary -->
                <div class="dashboard-grid" style="margin-bottom: 30px;">
                    <div class="card">
                        <h3>üìä –û–±—â–æ –î–∞–Ω–Ω–∏</h3>
                        <div class="metric" id="analysisDataCount">0</div>
                        <p>–ó–∞–ø–∏—Å–∞ –∑–∞ –∞–Ω–∞–ª–∏–∑</p>
                    </div>
                    <div class="card">
                        <h3>üéØ –û—Ç–∫—Ä–∏—Ç–∏–Ω–∏ –ê–Ω–æ–º–∞–ª–∏–∏</h3>
                        <div class="metric" style="color: #ff6b6b;" id="analysisAnomaliesCount">0</div>
                        <p>–û–±—â–æ –∞–Ω–æ–º–∞–ª–∏–∏</p>
                    </div>
                    <div class="card">
                        <h3>‚ö° –¢–æ—á–Ω–æ—Å—Ç</h3>
                        <div class="metric" style="color: #4caf50;">N/A</div>
                        <p>–ö–∞—á–µ—Å—Ç–≤–æ –Ω–∞ –¥–µ—Ç–µ–∫—Ü–∏—è—Ç–∞</p>
                    </div>
                    <div class="card">
                        <h3>üìà –¢–µ–Ω–¥–µ–Ω—Ü–∏—è</h3>
                        <div class="metric" style="color: #2196f3;">-</div>
                        <p>–û–±—â —Ç—Ä–µ–Ω–¥</p>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="chart-container">
                    <h3>üìä –ì—Ä–∞—Ñ–∏–∫–∏ –Ω–∞ –î–∞–Ω–Ω–∏—Ç–µ</h3>
                    <div style="margin-bottom: 20px;">
                        <button class="tab-btn active" onclick="showChart('sales')">üí∞ –ü—Ä–æ–¥–∞–∂–±–∏</button>
                        <button class="tab-btn" onclick="showChart('traffic')">üåê –¢—Ä–∞—Ñ–∏–∫</button>
                        <button class="tab-btn" onclick="showChart('production')">üè≠ –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ</button>
                        <button class="tab-btn" onclick="showChart('combined')">üìä –ö–æ–º–±–∏–Ω–∏—Ä–∞–Ω–∏</button>
                    </div>
                    
                    <div id="chartArea">
                        <div style="height: 300px; background: linear-gradient(45deg, #f8f9fa, #e9ecef); border: 2px dashed #dee2e6; display: flex; align-items: center; justify-content: center; border-radius: 10px;">
                            <div style="text-align: center;">
                                <div style="font-size: 48px; margin-bottom: 10px;">üìà</div>
                                <h4>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∏ –ì—Ä–∞—Ñ–∏–∫–∏</h4>
                                <p>–î–æ–±–∞–≤–µ—Ç–µ –¥–∞–Ω–Ω–∏ –≤ —Ä–∞–∑–¥–µ–ª "–ù–∞—Å—Ç—Ä–æ–π–∫–∏"<br>–∑–∞ –¥–∞ –≤–∏–¥–∏—Ç–µ –≥—Ä–∞—Ñ–∏–∫–∏ –∏ –∞–Ω–∞–ª–∏–∑</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Screen -->
            <div id="settings" class="screen">
                <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                
                <!-- Data Sources Configuration -->
                <div class="card">
                    <h3>üìä –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞ –ò–∑—Ç–æ—á–Ω–∏—Ü–∏—Ç–µ –Ω–∞ –î–∞–Ω–Ω–∏</h3>
                    <div class="form-group">
                        <label>–ê–∫—Ç–∏–≤–Ω–∏ —Ç–∏–ø–æ–≤–µ –¥–∞–Ω–Ω–∏:</label>
                        <div style="margin-top: 10px;">
                            <label style="display: block; margin-bottom: 5px;">
                                <input type="checkbox" id="enableSales" checked> üí∞ –ü—Ä–æ–¥–∞–∂–±–∏
                            </label>
                            <label style="display: block; margin-bottom: 5px;">
                                <input type="checkbox" id="enableTraffic" checked> üåê –£–µ–±—Å–∞–π—Ç —Ç—Ä–∞—Ñ–∏–∫
                            </label>
                            <label style="display: block; margin-bottom: 5px;">
                                <input type="checkbox" id="enableProduction" checked> üè≠ –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–∏ –¥–∞–Ω–Ω–∏
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Anomaly Detection Settings -->
                <div class="card">
                    <h3>üö® –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞ –î–µ—Ç–µ–∫—Ü–∏—è –Ω–∞ –ê–Ω–æ–º–∞–ª–∏–∏</h3>
                    
                    <div class="form-group">
                        <label>–ü—Ä–æ–¥–∞–∂–±–∏ - –ü—Ä–∞–≥–æ–≤–µ –∑–∞ –ê–ª–∞—Ä–º–∞:</label>
                        <div style="display: flex; gap: 10px; margin-top: 5px;">
                            <input type="number" id="salesMinThreshold" class="form-control" placeholder="–ú–∏–Ω. —Å—Ç–æ–π–Ω–æ—Å—Ç" style="width: 48%;">
                            <input type="number" id="salesMaxThreshold" class="form-control" placeholder="–ú–∞–∫—Å. —Å—Ç–æ–π–Ω–æ—Å—Ç" style="width: 48%;">
                        </div>
                        <div style="margin-top: 10px;">
                            <label>–ê–ª–∞—Ä–º–∞ –ø—Ä–∏ –ø—Ä–æ–º—è–Ω–∞ > </label>
                            <input type="number" id="salesChangePercent" class="form-control" placeholder="%" style="width: 80px; display: inline-block;">
                            <span>%</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>–£–µ–±—Å–∞–π—Ç –¢—Ä–∞—Ñ–∏–∫ - –ü—Ä–∞–≥–æ–≤–µ:</label>
                        <div style="display: flex; gap: 10px; margin-top: 5px;">
                            <input type="number" id="trafficMinThreshold" class="form-control" placeholder="–ú–∏–Ω. –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–∏" style="width: 48%;">
                            <input type="number" id="trafficMaxThreshold" class="form-control" placeholder="–ú–∞–∫—Å. –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–∏" style="width: 48%;">
                        </div>
                        <div style="margin-top: 10px;">
                            <label>–ê–ª–∞—Ä–º–∞ –ø—Ä–∏ –ø—Ä–æ–º—è–Ω–∞ > </label>
                            <input type="number" id="trafficChangePercent" class="form-control" placeholder="%" style="width: 80px; display: inline-block;">
                            <span>%</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ - –ü—Ä–∞–≥–æ–≤–µ:</label>
                        <div style="display: flex; gap: 10px; margin-top: 5px;">
                            <input type="number" id="productionMinThreshold" class="form-control" placeholder="–ú–∏–Ω. –µ–¥–∏–Ω–∏—Ü–∏" style="width: 48%;">
                            <input type="number" id="productionMaxThreshold" class="form-control" placeholder="–ú–∞–∫—Å. –µ–¥–∏–Ω–∏—Ü–∏" style="width: 48%;">
                        </div>
                        <div style="margin-top: 10px;">
                            <label>–ê–ª–∞—Ä–º–∞ –ø—Ä–∏ –ø—Ä–æ–º—è–Ω–∞ > </label>
                            <input type="number" id="productionChangePercent" class="form-control" placeholder="%" style="width: 80px; display: inline-block;">
                            <span>%</span>
                        </div>
                    </div>

                    <button onclick="saveAnomalySettings()" class="btn" style="margin-top: 20px;">üíæ –ó–∞–ø–∞–∑–∏ –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                </div>

                <!-- Data Input Section -->
                <div class="card">
                    <h3>üìù –í—ä–≤–µ–∂–¥–∞–Ω–µ –Ω–∞ –î–∞–Ω–Ω–∏</h3>
                    
                    <div class="data-input-tabs">
                        <button class="tab-btn active" onclick="showDataTab('sales')">üí∞ –ü—Ä–æ–¥–∞–∂–±–∏</button>
                        <button class="tab-btn" onclick="showDataTab('traffic')">üåê –¢—Ä–∞—Ñ–∏–∫</button>
                        <button class="tab-btn" onclick="showDataTab('production')">üè≠ –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ</button>
                        <button class="tab-btn" onclick="showDataTab('csv')">üìÅ CSV –ò–º–ø–æ—Ä—Ç</button>
                    </div>

                    <!-- Sales Data Input -->
                    <div id="salesDataInput" class="data-tab-content active">
                        <h4>üí∞ –í—ä–≤–µ–∂–¥–∞–Ω–µ –Ω–∞ –ü—Ä–æ–¥–∞–∂–±–∏</h4>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                            <input type="date" id="salesDate" class="form-control" style="width: 30%;">
                            <input type="number" id="salesAmount" class="form-control" placeholder="–°—É–º–∞ –≤ –ª–≤." style="width: 30%;">
                            <input type="text" id="salesDescription" class="form-control" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" style="width: 30%;">
                            <button onclick="addSalesData()" class="btn" style="width: 10%;">‚ûï</button>
                        </div>
                    </div>

                    <!-- Traffic Data Input -->
                    <div id="trafficDataInput" class="data-tab-content">
                        <h4>üåê –í—ä–≤–µ–∂–¥–∞–Ω–µ –Ω–∞ –¢—Ä–∞—Ñ–∏–∫</h4>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                            <input type="date" id="trafficDate" class="form-control" style="width: 25%;">
                            <input type="number" id="trafficVisitors" class="form-control" placeholder="–ü–æ—Å–µ—Ç–∏—Ç–µ–ª–∏" style="width: 20%;">
                            <input type="number" id="trafficPageViews" class="form-control" placeholder="–ü—Ä–µ–≥–ª–µ–¥–∏" style="width: 20%;">
                            <input type="text" id="trafficSource" class="form-control" placeholder="–ò–∑—Ç–æ—á–Ω–∏–∫" style="width: 25%;">
                            <button onclick="addTrafficData()" class="btn" style="width: 10%;">‚ûï</button>
                        </div>
                    </div>

                    <!-- Production Data Input -->
                    <div id="productionDataInput" class="data-tab-content">
                        <h4>üè≠ –í—ä–≤–µ–∂–¥–∞–Ω–µ –Ω–∞ –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–∏ –î–∞–Ω–Ω–∏</h4>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                            <input type="date" id="productionDate" class="form-control" style="width: 25%;">
                            <input type="number" id="productionUnits" class="form-control" placeholder="–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏ –µ–¥–∏–Ω–∏—Ü–∏" style="width: 25%;">
                            <input type="number" id="productionDefects" class="form-control" placeholder="–î–µ—Ñ–µ–∫—Ç–∏" style="width: 20%;">
                            <input type="text" id="productionLine" class="form-control" placeholder="–õ–∏–Ω–∏—è" style="width: 20%;">
                            <button onclick="addProductionData()" class="btn" style="width: 10%;">‚ûï</button>
                        </div>
                    </div>

                    <!-- CSV Import -->
                    <div id="csvDataInput" class="data-tab-content">
                        <h4>üìÅ CSV –ò–º–ø–æ—Ä—Ç</h4>
                        <div style="margin-bottom: 15px;">
                            <label>–ò–∑–±–µ—Ä–∏ —Ç–∏–ø –¥–∞–Ω–Ω–∏:</label>
                            <select id="csvDataType" class="form-control" style="width: 200px; display: inline-block; margin-left: 10px;">
                                <option value="sales">üí∞ –ü—Ä–æ–¥–∞–∂–±–∏</option>
                                <option value="traffic">üåê –¢—Ä–∞—Ñ–∏–∫</option>
                                <option value="production">üè≠ –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ</option>
                            </select>
                        </div>
                        <input type="file" id="csvFileInput" accept=".csv" class="form-control" style="margin-bottom: 10px;">
                        <button onclick="importCSV()" class="btn">üì§ –ò–º–ø–æ—Ä—Ç–∏—Ä–∞–π CSV</button>
                        <div id="csvPreview" style="margin-top: 15px; display: none;">
                            <h5>–ü—Ä–µ–≥–ª–µ–¥ –Ω–∞ –¥–∞–Ω–Ω–∏—Ç–µ:</h5>
                            <div id="csvPreviewContent"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Panel -->
            <div id="adminPanel" class="screen">
                <div class="admin-header">
                    <h2>üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—Å–∫–∏ –ü–∞–Ω–µ–ª</h2>
                    <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ –∏ —Å–∏—Å—Ç–µ–º–Ω–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</p>
                </div>
                
                <div class="table-container">
                    <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏</h3>
                    <table id="usersTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>–ò–º–µ</th>
                                <th>–ò–º–µ–π–ª</th>
                                <th>–†–æ–ª—è</th>
                                <th>–ö–æ–º–ø–∞–Ω–∏—è</th>
                                <th>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</th>
                                <th>–ü–æ—Å–ª–µ–¥–µ–Ω –≤—Ö–æ–¥</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏—Ç–µ —â–µ —Å–µ –∑–∞—Ä–µ–¥—è—Ç –æ—Ç JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script src="auth.js"></script>
    <script src="data-manager.js"></script>
    <script src="ui-manager.js"></script>
    <script>
        // Navigation function
        function showScreen(screenName) {
            // Hide all screens
            const screens = document.querySelectorAll('.screen');
            screens.forEach(screen => {
                screen.classList.remove('active');
            });
            
            // Show selected screen
            const targetScreen = document.getElementById(screenName);
            if (targetScreen) {
                targetScreen.classList.add('active');
            }
            
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Find and activate correct nav item
            const navLink = document.querySelector(`[onclick*="${screenName}"]`);
            if (navLink && navLink.closest('.nav-item')) {
                navLink.closest('.nav-item').classList.add('active');
            }
        }
        
        // Enhanced showAdminPanel function
        function showAdminPanel() {
            showScreen('adminPanel');
            setTimeout(() => {
                if (typeof loadUsersTable === 'function') {
                    loadUsersTable();
                }
            }, 100);
        }

        // Load and display users in admin panel
        function loadUsersTable() {
            const usersTableBody = document.querySelector('#usersTable tbody');
            if (!usersTableBody) return;
            
            const allUsers = Object.values(users);
            
            if (allUsers.length === 0) {
                usersTableBody.innerHTML = '<tr><td colspan="8" style="text-align: center;">–ù—è–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞–Ω–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏</td></tr>';
                return;
            }
            
            usersTableBody.innerHTML = allUsers.map((user, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td><span style="color: ${user.role === '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' ? '#ff6b6b' : '#4caf50'};">${user.role}</span></td>
                    <td>${user.company || 'N/A'}</td>
                    <td>${user.createdAt ? formatDate(user.createdAt) : 'N/A'}</td>
                    <td>${user.lastLogin ? formatDate(user.lastLogin) : '–ù–∏–∫–æ–≥–∞'}</td>
                    <td>
                        <button onclick="deleteUser('${user.email}')" class="btn btn-sm btn-danger">üóëÔ∏è –ò–∑—Ç—Ä–∏–π</button>
                        <button onclick="toggleUserRole('${user.email}')" class="btn btn-sm" style="background: #ffa94d;">üîÑ –°–º–µ–Ω–∏ —Ä–æ–ª—è</button>
                    </td>
                </tr>
            `).join('');
        }

        // Delete user function
        function deleteUser(userEmail) {
            if (userEmail === currentUser.email) {
                showNotification('‚ùå –ù–µ –º–æ–∂–µ—Ç–µ –¥–∞ –∏–∑—Ç—Ä–∏–µ—Ç–µ —Å–æ–±—Å—Ç–≤–µ–Ω–∏—è —Å–∏ –∞–∫–∞—É–Ω—Ç!', 'error');
                return;
            }
            
            if (confirm(`–°–∏–≥—É—Ä–Ω–∏ –ª–∏ —Å—Ç–µ, —á–µ –∏—Å–∫–∞—Ç–µ –¥–∞ –∏–∑—Ç—Ä–∏–µ—Ç–µ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è ${userEmail}?`)) {
                delete users[userEmail];
                localStorage.setItem('biAlarmUsers', JSON.stringify(users));
                loadUsersTable();
                showNotification('‚úÖ –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è—Ç –µ –∏–∑—Ç—Ä–∏—Ç —É—Å–ø–µ—à–Ω–æ!', 'success');
            }
        }

        // Toggle user role function
        function toggleUserRole(userEmail) {
            if (userEmail === currentUser.email) {
                showNotification('‚ùå –ù–µ –º–æ–∂–µ—Ç–µ –¥–∞ –ø—Ä–æ–º–µ–Ω–∏—Ç–µ —Å–æ–±—Å—Ç–≤–µ–Ω–∞—Ç–∞ —Å–∏ —Ä–æ–ª—è!', 'error');
                return;
            }
            
            const user = users[userEmail];
            if (!user) return;
            
            const newRole = user.role === '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' ? '–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª' : '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä';
            
            if (confirm(`–°–º—è–Ω–∞ –Ω–∞ —Ä–æ–ª—è—Ç–∞ –Ω–∞ ${user.name} –æ—Ç "${user.role}" –Ω–∞ "${newRole}"?`)) {
                user.role = newRole;
                localStorage.setItem('biAlarmUsers', JSON.stringify(users));
                loadUsersTable();
                showNotification(`‚úÖ –†–æ–ª—è—Ç–∞ –Ω–∞ ${user.name} –µ —Å–º–µ–Ω–µ–Ω–∞ –Ω–∞ ${newRole}!`, 'success');
            }
        }
        
        console.log('üéâ BI Anomaly Detection System loaded successfully!');
    </script>
</body>
</html>